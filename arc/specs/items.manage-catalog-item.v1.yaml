spec:
  id: items.manage-catalog-item.v1
  objective: "As an engineer, I can create and manage catalog items (building components) with codes, names, and measurement units."
  packs: ["domain.modeling", "domain.events", "application.services", "mapping.layer", "tests.unit"]
  scope:
    domain:
      - "Entity: Item(code, name, measure)"
      - "ValueObject: Measure(Units, Inches)"
      - "UseCase: CreateItem(code, name, measure)"
      - "UseCase: UpdateItem(code, name, measure)"
      - "UseCase: ListItems()"
      - "UseCase: GetItem(code)"
    ports:
      driving:        # offered to outside callers
        - "HTTP: POST /api/items (OpenAPI: ../contracts/openapi/items.v1.yaml#/paths/~1api~1items)"
        - "HTTP: PUT /api/items/{code} (OpenAPI: ../contracts/openapi/items.v1.yaml#/paths/~1api~1items~1{code})"
        - "HTTP: GET /api/items (OpenAPI: ../contracts/openapi/items.v1.yaml#/paths/~1api~1items)"
        - "HTTP: GET /api/items/{code} (OpenAPI: ../contracts/openapi/items.v1.yaml#/paths/~1api~1items~1{code})"
      driven:         # required by domain (to be implemented by adapters)
        - "ItemRepositoryPort.Save(item) (Schema: ../contracts/schemas/ports/item-repository.v1.json)"
        - "ItemRepositoryPort.FindByCode(code) (Schema: ../contracts/schemas/ports/item-repository.v1.json)"
        - "ItemRepositoryPort.FindAll() (Schema: ../contracts/schemas/ports/item-repository.v1.json)"
  nfr:
    purity: "domain.no.framework.refs"
    contracts: ["port.contract.declared", "port.contract.versioned"]
    conformance: "adapter.conforms.to.port"
    perf: "perf.p95.200ms"
    validation: "item.code.unique"
  scenarios:
    - name: create-item-happy-path
      given: "valid item data (code='2103', name='Frame', measure='Inches')"
      when: "CreateItem"
      then:
        - "Item created and persisted"
        - "ItemRepositoryPort.Save called with item"
    - name: create-item-duplicate-code
      given: "item with existing code"
      when: "CreateItem"
      then: "Conflict error; no side effects"
    - name: create-item-invalid-code
      given: "empty or invalid item code"
      when: "CreateItem"
      then: "Validation error; no side effects"
    - name: update-item-happy-path
      given: "existing item and valid update data"
      when: "UpdateItem"
      then: "Item updated and persisted"
    - name: update-item-not-found
      given: "non-existent item code"
      when: "UpdateItem"
      then: "NotFound error; no side effects"
    - name: list-items-happy-path
      given: "items exist in catalog"
      when: "ListItems"
      then: "All items returned with proper formatting"
deliverables:
  - "Domain entity: Item with validation rules"
  - "Value object: Measure enum (Units, Inches)"
  - "Use case handlers: CreateItem, UpdateItem, ListItems, GetItem"
  - "Port interface: ItemRepositoryPort"
  - "OpenAPI spec for items endpoints (driving ports)"
  - "Repository adapter stub: Database persistence layer"
  - "HTTP controller adapter: REST API implementation"
  - "Tests: domain entity specs, use case specs, contract conformance tests, e2e scenarios"
  - "Validation: Unique code constraints, required field validation"
